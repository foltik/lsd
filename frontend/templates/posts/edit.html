{% extends "editor.html" %}
{% block title %}Edit post - {{ post.title }}{% endblock title %}

{% block back %}
  <a href="/posts">&larr; All Posts</a>
{% endblock back %}

{% block actions %}
  <button id="send" class="ext/button" type="button">Send</button>
{% endblock actions %}

{% block form %}
  <div class="field">
    <label for="title">Title</label>
    <input
      type="text"
      id="title"
      name="title"
      value="{{ post.title }}"
      required
    />
  </div>
  <div class="field">
    <label for="slug">Slug</label>
    <input type="text" id="slug" name="slug" value="{{ post.slug }}" required />
  </div>
  <div class="field">
    <label for="author">Author</label>
    <input
      type="text"
      id="author"
      name="author"
      value="{{ post.author }}"
      required
    />
  </div>
{% endblock form %}

{% block extra_scripts %}
  <script>
    const slug = document.getElementById("slug");
    slug.addEventListener("input", () => {
      history.replaceState(null, "", `/posts/${slug.value}/edit`);
    });

    document.getElementById("send").addEventListener("click", () => {
      if (window.editor.entityId == 0 || window.editor.localUpdatedAt != null) {
        alert("Please save first!");
      } else {
        const slug = document.getElementById("slug").value;
        window.location.href = `/posts/${slug}/send`;
      }
    });
  </script>
{% endblock extra_scripts %}
