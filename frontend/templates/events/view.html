{% extends "layout.html" %}

{% block title %}{{ event.title }}{% endblock title %}

{% block content %}
  <div id="events/view">
    <h1>Update Event: {{ event.title }}</h1>
    <form
      class="ext/form"
      action="/events/{{ event.id }}/update"
      method="post"
      onsubmit="normalizeDateTime(event)"
    >
      <div class="field">
        <label for="title">Event Title</label>
        <input type="text" name="title" value="{{ event.title }}" />
      </div>

      <div class="field">
        <label for="description">Event Description</label>
        <textarea name="description" value="{{ event.description }}">
        What can people expect...
      </textarea>
      </div>

      <div class="field">
        <label for="start_select">Event Date</label>
        <input
          type="datetime-local"
          name="start_select"
          value="{{ event.start }}"
        />
      </div>

      <input type="hidden" name="start" />

      <!-- <label for="cover_image">Event Cover Image</label>
            <input type="file" name="cover_image" /> -->

      <button type="submit">Update</button>
    </form>
    <form class="ext/form" action="/events/{{ event.id }}/delete" method="post">
      <button type="submit">Delete</button>
    </form>

    {% for event_ticket in event_tickets %}
      <div class="ticket-row">
        <input
          type="hidden"
          name="tickets[{{ loop.index0 }}].ticket_id"
          value="{{ event_ticket.ticket_id }}"
        />
        <div class="field">
          <label for="tickets[{{ loop.index0 }}].price">Price</label>
          <input
            type="number"
            name="tickets[{{ loop.index0 }}].price"
            value="{{ event_ticket.price }}"
            min="0"
          />
        </div>
        <div class="field">
          <label for="tickets[{{ loop.index0 }}].quantity">Quantity</label>
          <input
            type="number"
            name="tickets[{{ loop.index0 }}].quantity"
            value="{{ event_ticket.quantity }}"
            min="0"
          />
        </div>

    <form
      action="/events/{{ event.id }}/tickets/{{ event_ticket.ticket_id }}/delete"
      method="post"
      style="display: inline;"
    >
      <button type="submit" class="remove-ticket">Remove</button>
      </div>
    {% endfor %}
    <script>
      function normalizeDateTime(e) {
        e.preventDefault();
        const form = e.target;
        const inputA = form.querySelector('[name="start_select"]');
        const inputB = form.querySelector('[name="start"]');
        inputB.value = inputA.value + ":00";
        dbg!(&form);
        form.submit();
      }
    </script>
  </div>
{% endblock content %}
