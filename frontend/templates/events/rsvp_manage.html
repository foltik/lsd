{% extends "layout.html" %}

{% block title %}light and sound - Manage{% endblock title %}

{% block content %}
  <section id="events/rsvp/manage" class="ext/layout standard">
    <header>
      <h1>Thank you!</h1>
    </header>
    <p class="intro">
      Your RSVP and contribution have been received. A confirmation email will
      be sent to each listed attendee shortly.
    </p>

    <div class="summary">
      <h2>Summary</h2>
      <ul class="line-items">
        {% for rsvp in rsvps %}
          <li class="item">
            <div class="contact">
              <div class="title">{{ rsvp.spot_name }}</div>
              <span class="attendee"
                >{{ rsvp.first_name }} {{ rsvp.last_name }} â€¢
                {{ rsvp.email }}</span
              >
            </div>
            <span class="price">${{ rsvp.contribution }}</span>
          </li>
        {% endfor %}
        <li class="total">
          <span class="left">Total</span>
          <span id="total" class="right">$0</span>
        </li>
      </ul>
    </div>
  </section>
{% endblock content %}

{% block scripts %}
  <script>
    /* ---------- Save session ------------------------------------------------ */
    const queryString = new URLSearchParams(location.search);
    const token = encodeURIComponent(queryString.get("session"));
    const key = `rsvps/{{ session.event_id }}`;
    localStorage[key] = JSON.stringify({ token, page: "manage" });

    /* ---------- Populate total ---------------------------------------------- */
    const rsvps = JSON.parse(`{{ rsvps | json | safe }}`);
    const total = rsvps.reduce((sum, r) => sum + r.contribution, 0);
    document.getElementById("total").textContent = `$${total}`;
  </script>
{% endblock scripts %}
